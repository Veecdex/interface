<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>My Orders</title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- Modern font -->
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">

<script>
  tailwind.config = {
    theme: {
      extend: {
        fontFamily: {
          app: ['Manrope', 'sans-serif'],
        },
        colors: {
          nightPrimary: '#2c2a63', // Night-sky premium accent
        }
      },
    },
  }
</script>
</head>

<body class="bg-[#f7f7f7] font-app text-gray-800">

<!-- APP HEADER -->
<header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b">
  <div class="max-w-md mx-auto px-4 py-3 text-center font-semibold">
    My Orders
  </div>
</header>

<!-- ORDERS LIST -->
<main class="max-w-md mx-auto px-4 py-4 space-y-4" id="ordersContainer"></main>

<!-- ORDER DETAILS (SLIDE PANEL) -->
<section
  id="orderPanel"
  class="fixed top-0 right-[-100%] w-full max-w-md h-full bg-white z-50 transition-all duration-300 flex flex-col">

  <!-- PANEL HEADER -->
  <div class="flex items-center px-4 py-3 border-b">
    <button onclick="closePanel()" class="mr-3 text-nightPrimary">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
        viewBox="0 0 24 24">
        <path d="M15 19l-7-7 7-7"/>
      </svg>
    </button>
    <p id="panelRef" class="flex-1 text-center font-medium">Order Ref</p>
  </div>

  <!-- PANEL BODY -->
  <div class="flex-1 overflow-y-auto px-4 py-5 space-y-6">

    <!-- ORDER STATUS -->
    <div>
      <p class="text-sm font-medium mb-3">Order Status</p>

      <!-- TRACK -->
      <div class="relative h-2 rounded-full bg-gray-200 overflow-hidden">
        <div class="absolute left-0 top-0 h-full w-2/3 bg-nightPrimary"></div>

        <!-- CAR -->
        <div class="absolute -top-4 left-[65%] animate-car text-nightPrimary">
          ðŸš—
        </div>
      </div>

      <p class="mt-3 text-sm flex items-center gap-2 text-nightPrimary">
        <span class="w-2 h-2 bg-nightPrimary rounded-full animate-pulse"></span>
        Your order is on the way
      </p>
    </div>

    <hr/>

    <!-- SHIPPING -->
    <div>
      <p class="text-sm font-medium">Shipping Fee</p>
      <p class="text-lg font-semibold mt-1">â‚¦500</p>
    </div>

    <div class="bg-gray-100 rounded-xl p-3 text-sm text-gray-800">
      Please kindly send the above amount to the following account number for shipping.
    </div>

    <div>
      <label class="text-sm font-medium block mb-1">
        Already made payment? Upload receipt
      </label>
      <input
        type="file"
        class="w-full p-2 border rounded-xl bg-white text-gray-800 border-gray-300"/>
    </div>

    <hr/>

    <!-- REFUND -->
    <div>
      <p class="text-sm font-medium mb-1">Request Refund</p>
      <div class="bg-gray-100 rounded-xl p-3 text-sm mb-3">
        We refund within 24 business hours.
      </div>
      <button
        class="w-full bg-nightPrimary text-white py-3 rounded-xl hover:opacity-90 transition">
        Refund Me
      </button>
    </div>

    <hr/>

    <!-- CHECKOUT DETAILS -->
    <div>
      <p class="text-sm font-medium mb-2">Checkout Details</p>
      <div id="checkoutInfo" class="text-sm space-y-1 text-gray-700"></div>
    </div>

  </div>
</section>

<!-- CAR ANIMATION -->
<style>
@keyframes car-move {
  0% { transform: translateX(0); }
  50% { transform: translateX(6px); }
  100% { transform: translateX(0); }
}
.animate-car {
  animation: car-move 1.3s ease-in-out infinite;
}
</style>

<script type="module">
  /* ================= FIREBASE ================= */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, collection, getDocs, query, orderBy } 
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  
  const firebaseConfig = {
      apiKey: "AIzaSyAyDac2t2GrNFAPeYq37QKCSulM5_fkcGg",
      authDomain: "wiesel-80160.firebaseapp.com",
      projectId: "wiesel-80160",
      storageBucket: "wiesel-80160.firebasestorage.app",
      messagingSenderId: "632126721223",
      appId: "1:632126721223:web:7e1057a7d02a65ef5542e2"
    };
  
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  
  /* ================= UI ELEMENTS (UNCHANGED) ================= */
  const container = document.getElementById('ordersContainer');
  const panel = document.getElementById('orderPanel');
  const panelRef = document.getElementById('panelRef');
  const checkoutInfo = document.getElementById('checkoutInfo');
  
  let ordersCache = {};
  
  /* ================= LOAD ORDERS ================= */
  onAuthStateChanged(auth, async user => {
    if (!user) return;
  
    const q = query(
      collection(db, "users", user.uid, "orders"),
      orderBy("createdAt", "desc")
    );
  
    const snap = await getDocs(q);
    container.innerHTML = "";
  
    snap.forEach(docSnap => {
      const o = docSnap.data();
      ordersCache[docSnap.id] = o;
  
      container.innerHTML += `
        <div class="bg-white rounded-2xl p-4 shadow-sm">
          <div class="flex justify-between items-center mb-2">
            <p class="text-sm font-medium">Order Ref</p>
            <span class="text-xs px-3 py-1 rounded-full bg-nightPrimary/10 text-nightPrimary">
              ${o.status}
            </span>
          </div>
  
          <p class="text-sm font-semibold">${o.ref}</p>
          <p class="text-sm text-gray-500 mt-1">â‚¦${o.amount}</p>
  
          <button onclick="openOrder('${docSnap.id}')"
            class="mt-4 w-full bg-nightPrimary text-white py-2 rounded-xl">
            View Status
          </button>
        </div>
      `;
    });
  });
  
  /* ================= OPEN ORDER PANEL (UNCHANGED UI) ================= */
  window.openOrder = function (id) {
    const o = ordersCache[id];
    if (!o) return;
  
    panelRef.textContent = o.ref;
  
    checkoutInfo.innerHTML = `
      <p>Name: ${o.name}</p>
      <p>Email: ${o.email}</p>
      <p>Phone: ${o.phone}</p>
      <p class="mt-2 font-medium">Products:</p>
      ${o.items.map(i => `<p>â€¢ ${i.title} â€” â‚¦${i.price}</p>`).join("")}
      <p class="mt-2 font-semibold">Total: â‚¦${o.amount}</p>
    `;
  
    panel.style.right = '0';
  };
  
  window.closePanel = function () {
    panel.style.right = '-100%';
  };
  </script>
  

</body>
</html>
