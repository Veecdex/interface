<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>My Orders</title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- Modern font -->
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">

<script>
  tailwind.config = {
    theme: {
      extend: {
        fontFamily: {
          app: ['Manrope', 'sans-serif'],
        },
        colors: {
          nightPrimary: '#2c2a63', // Night-sky premium accent
        }
      },
    },
  }
</script>
</head>

<body class="bg-[#f7f7f7] font-app text-gray-800">

<!-- APP HEADER -->
<header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b">
  <div class="max-w-md mx-auto px-4 py-3 flex items-center justify-center relative">

    <!-- Back Button -->
    <button 
      onclick="history.back()" 
      class="absolute left-4 text-gray-700 hover:text-black transition"
      aria-label="Go back"
    >
      <!-- Arrow Left Icon -->
      <svg xmlns="http://www.w3.org/2000/svg" 
        class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M15 19l-7-7 7-7" />
      </svg>
    </button>

    <!-- Title -->
    <span class="font-semibold">My Orders</span>

  </div>
</header>

<!-- PRELOADER -->
<div id="ordersPreloader" class="flex flex-col items-center justify-center py-20 space-y-3">
  <!-- Bouncing shopping bag -->
  <svg class="w-12 h-12 text-nightPrimary animate-bounce" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" d="M6 2h12l1 7H5L6 2zM6 9h12v13H6V9z"/>
  </svg>

  <p class="text-gray-500 font-medium">Loading your orders...</p>
</div>

<!-- ORDERS LIST -->
<main class="max-w-md mx-auto px-4 py-4 space-y-4" id="ordersContainer"></main>

<!-- ORDER DETAILS (SLIDE PANEL) -->
<section
  id="orderPanel"
  class="fixed top-0 right-[-100%] w-full max-w-md h-full bg-white z-50 transition-all duration-300 flex flex-col">

  <!-- PANEL HEADER -->
  <div class="flex items-center px-4 py-3 border-b">
    <button onclick="closePanel()" class="mr-3 text-nightPrimary">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
        viewBox="0 0 24 24">
        <path d="M15 19l-7-7 7-7"/>
      </svg>
    </button>
    <p id="panelRef" class="flex-1 text-center font-medium">Order Ref</p>
  </div>

  <!-- PANEL BODY -->
  <div class="flex-1 overflow-y-auto px-4 py-5 space-y-6">

    <!-- ORDER STATUS -->
    <div>
      

    <!-- CHECKOUT DETAILS -->
    <div>
      <p class="text-sm font-medium mb-2">Order Details</p>
      <div id="checkoutInfo" class="text-sm space-y-1 text-gray-700"></div>
    </div>

  </div>
</section>

<!-- CAR ANIMATION -->
<style>
@keyframes car-move {
  0% { transform: translateX(0); }
  50% { transform: translateX(6px); }
  100% { transform: translateX(0); }
}
.animate-car {
  animation: car-move 1.3s ease-in-out infinite;
}
</style>

<script type="module">
/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, getDocs, query, orderBy }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAyDac2t2GrNFAPeYq37QKCSulM5_fkcGg",
      authDomain: "wiesel-80160.firebaseapp.com",
      projectId: "wiesel-80160",
      storageBucket: "wiesel-80160.firebasestorage.app",
      messagingSenderId: "632126721223",
      appId: "1:632126721223:web:7e1057a7d02a65ef5542e2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ================= UI ELEMENTS ================= */
const container = document.getElementById('ordersContainer');
const panel = document.getElementById('orderPanel');
const panelRef = document.getElementById('panelRef');
const checkoutInfo = document.getElementById('checkoutInfo');

let ordersCache = {};

/* ================= LOAD ORDERS ================= */
onAuthStateChanged(auth, async user => {
  if (!user) return;

  const q = query(
    collection(db, "users", user.uid, "orders"),
    orderBy("createdAt", "desc")
  );

  const snap = await getDocs(q);
  container.innerHTML = "";

  snap.forEach(docSnap => {
    const o = docSnap.data();
    ordersCache[docSnap.id] = o;

    container.innerHTML += `
      <div class="bg-white rounded-2xl p-4 shadow-sm">
        <div class="flex justify-between items-center mb-2">
          <p class="text-sm font-medium">Order Ref</p>
          <span class="text-xs px-3 py-1 rounded-full bg-nightPrimary/10 text-nightPrimary">
            ${o.status || 'Processing'}
          </span>
        </div>

        <p class="text-sm font-semibold">${o.ref || '‚Äî'}</p>
        <p class="text-sm text-gray-500 mt-1">‚Ç¶${o.amount || 0}</p>

        <button
          onclick="openOrder('${docSnap.id}')"
          class="mt-4 w-full bg-nightPrimary text-white py-2 rounded-xl">
          View Details
        </button>
      </div>
    `;
  });
});

/* ================= OPEN ORDER PANEL ================= */
window.openOrder = function (id) {
  const o = ordersCache[id];
  if (!o) return;

  const name = o.name || 'Customer';
  const email = o.email || '‚Äî';
  const phone = o.phone || '‚Äî';
  const address = o.address || 'Delivery address not provided';
  const items = Array.isArray(o.items) ? o.items : [];
  const amount = o.amount || 0;
  const ref = o.ref || 'Order Details';

  // DELIVERY PAYMENT (ADMIN EDITABLE FROM ORDER DOC)
  const deliveryFee = o.shipping || 'will be updated soon';
  const bankName = o.deliveryBankName || '‚Äî';
  const accountName = o.deliveryAccountName || '‚Äî';
  const accountNumber = o.deliveryAccountNumber || '‚Äî';

  panelRef.textContent = ref;

  checkoutInfo.innerHTML = `
    <div class="space-y-4 text-sm">

      <!-- MESSAGE -->
      <div class="bg-white rounded-2xl p-4 shadow-sm space-y-3">
        <p class="text-gray-800">
          Dear <span class="font-semibold">${name}</span>,
        </p>

        <p class="text-gray-600">
          Thank you for your order ü§ç Your items will be delivered to:
        </p>

        <div class="bg-gray-50 rounded-xl p-3 text-gray-700">
          ${address}
        </div>

        <p class="text-gray-600">
          We will contact you on
          <span class="font-semibold">${phone}</span>
          when we are approximately
          <span class="font-semibold">30 minutes away</span>.
        </p>

        <div class="border-t border-dashed"></div>

        <p class="text-gray-600">
          üöö Delivery typically takes
          <span class="font-semibold">2 business days</span>.
        </p>
      </div>

      <!-- SHIPPING PAYMENT -->
      <div class="bg-white rounded-2xl p-4 shadow-sm space-y-3">
        <p class="font-semibold text-gray-800">Shipping Payment</p>

        <p class="text-gray-600 leading-relaxed">
          Kindly make payment to the account below for shipping.
          The shipping cost is:
        </p>

        <div class="bg-gray-100 rounded-xl p-3 flex justify-between items-center">
          <span class="font-medium text-gray-700">Delivery Fee</span>
          <span class="font-mono font-semibold text-lg">‚Ç¶${deliveryFee}</span>
        </div>

        <div class="bg-gray-50 rounded-xl p-3 space-y-1 text-gray-700">
          <p><span class="text-gray-400">Bank</span><br>Moniepoint</p>
          <p><span class="text-gray-400">Account Name</span><br>Your Business Name</p>
          <p><span class="text-gray-400">Account Number</span><br>1234567890</p>
        </div>

        <p class="text-xs text-gray-500">
          Please use your order reference as payment narration.
        </p>

        <button
          onclick="requestRefund('${id}')"
          class="w-full border border-red-200 text-red-600 py-2 rounded-xl hover:bg-red-50 transition">
          Request Refund
        </button>
      </div>

      <!-- MY INFO -->
      <div class="bg-white rounded-2xl p-4 shadow-sm">
        <p class="font-semibold text-gray-800 mb-2">My Info</p>
        <div class="space-y-1 text-gray-600">
          <p><span class="text-gray-400">Name</span><br>${name}</p>
          <p><span class="text-gray-400">Email</span><br>${email}</p>
          <p><span class="text-gray-400">Phone</span><br>${phone}</p>
        </div>
      </div>

      <!-- ITEMS -->
      <div class="bg-white rounded-2xl p-4 shadow-sm">
        <p class="font-semibold text-gray-800 mb-2">Items</p>

        ${
          items.length
            ? items.map(i => `
              <div class="flex justify-between py-2 border-b last:border-none">
                <span class="text-gray-700">${i.title || 'Item'}</span>
                <span class="font-mono font-medium">${i.price || 0}</span>
              </div>
            `).join('')
            : `<p class="text-gray-400 text-sm">No items found</p>`
        }
      </div>

      <!-- TOTAL -->
      <div class="bg-gray-100 rounded-2xl p-4 flex justify-between items-center">
        <span class="font-semibold text-gray-700">Total</span>
        <span class="text-lg font-bold font-mono">‚Ç¶${amount}</span>
      </div>

    </div>
  `;

  panel.style.right = '0';
};

// Hide preloader
const preloader = document.getElementById("ordersPreloader");
if (preloader) preloader.style.display = "none";

/* ================= CLOSE PANEL ================= */
window.closePanel = function () {
  panel.style.right = '-100%';
};
</script>

  

</body>
</html>
